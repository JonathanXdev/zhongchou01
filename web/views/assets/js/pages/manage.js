$(document).ready(function() {
	$('#manage-sub').on('click',function(){
		$.post($('#manage-form').attr('action'),$('#manage-form').serialize(),function(res){
			if(res.id==1){
				toastr.success(res.msg);
				location.reload();
				$('.bs-manage-modal-sm').modal('hide');
			}else{
				toastr.error(res.msg);
			}
		},'json')
	})
	$('#add-manage').on('click',function(){
			$('#search-user').val('');
			$('input').val('');
			$('select').val('');
			$('.bs-manage-modal-sm').modal('show');	
	})
	$('#search-user-sub').on('click',function(){
			var that=$(this);
		$.post(searchuserurl,{key:$('#search-user').val()},function(res){
			if(res.id==1){
				$('input[name=user_id]').val(res.data.uid);
				toastr.success('找到相关管理员，请继续其他项目');
				that.parents('.form-group').removeClass('has-error').addClass('has-success');
			}else{
				toastr.info('没有找到管理员');
				that.parents('.form-group').removeClass('has-success').addClass('has-error');
			}
		},'json')
	})
	$('.edit_manage').on('click',function(){
			var mnjson=decodeURIComponent($('#m_list_'+$(this).data('id')).data('info'));
			var ndata=eval('('+mnjson+')');
			$('input[name=id]').val(ndata.id);
			$('#search-user').val(ndata.user_id);
			$('input[name=user_id]').val(ndata.user_id);
			$('select[name=role_id]').val(ndata.role_id);
			$('select[name=group_id]').val(ndata.group_id);
			$('input[name=name]').val(ndata.name);
			$('input[name=phone]').val(ndata.phone);
			$('input[name=email]').val(ndata.email);
			$('input[name=qq]').val(ndata.qq);
			$('.bs-manage-modal-sm').modal('show');	
	})
	$('.del_manage').on('click',function(){
		$('#manage-del-id').val($(this).data('id'));
		$('.manage-del-ml').modal('show');
		$('#manage-del-sub').on('click',function(){
			$.post($('#manage-del-form').attr('action'),$('#manage-del-form').serialize(),function(res){
			if(res.id==1){
				toastr.success(res.msg);
				$('#manage-del-id').val('');
				$('.manage-del-ml').modal('hide');
				location.reload();
			}else{
				toastr.error(res.msg);
			}
		},'json')
		})
	})
});